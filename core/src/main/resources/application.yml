spring:
  config:
    import:
      - classpath:application-prompts.yml
      - classpath:application-prompts-optimized.yml

prompts:
  variant: OPTIMIZED

core:
  review:
    max-retries: 3
    timeout-minutes: 10
    enable-caching: true

context-retrieval:
  enabled: true
  strategy-timeout-seconds: 5
  enabled-strategies:
    - metadata-based
    - git-history
  rollout:
    percentage: 100
    skip-large-diffs: true
    max-diff-lines: 5000

  git-history:
    enabled: true
    analysis-depth: 100
    co-change-threshold: 3
    confidence-minimum: 0.3
    time-window-days: 90

  diff-expansion:
    enabled: true
    max-file-size-kb: 100
    max-line-count: 500
    max-files-to-expand: 10
    excluded-extensions:
      - .lock
      - .svg
      - .png
      - .jpg
      - .gif
      - .ico

  pr-metadata:
    enabled: true
    include-labels: true
    include-commits: true
    include-author: true
    max-commit-messages: 5

  policies:
    enabled: true
    max-content-chars: 5000
    include-contributing: true
    include-code-of-conduct: false
    include-pr-template: true
    include-security: true

# Ticket System Configuration
ticket-system:
  jira:
    enabled: true
    base-url: ${JIRA_BASE_URL:http://localhost:8080}
    token: ${JIRA_TOKEN:}

logging:
  level:
    com.ghiloufi.aicode.core: DEBUG
    org.kohsuke.github: INFO

# Resilience4j Configuration
resilience4j:
  retry:
    configs:
      critical:
        maxAttempts: 3
        waitDuration: 200ms
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - java.io.IOException
          - java.net.ConnectException
          - org.springframework.web.reactive.function.client.WebClientException
          - org.gitlab4j.api.GitLabApiException
        ignoreExceptions:
          - java.lang.IllegalArgumentException
          - java.lang.NullPointerException

      best-effort:
        maxAttempts: 2
        waitDuration: 100ms
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - java.io.IOException
          - java.sql.SQLException
          - org.springframework.dao.DataAccessException

      optional:
        maxAttempts: 1
        waitDuration: 0ms

    instances:
      scm-get-diff:
        baseConfig: critical
      scm-publish-review:
        baseConfig: critical
      scm-get-merge-requests:
        baseConfig: critical
      scm-publish-summary:
        baseConfig: best-effort
      ai-streaming:
        baseConfig: critical
        maxAttempts: 2
      context-enrichment:
        baseConfig: critical
      db-save-review:
        baseConfig: best-effort
      ticket-context:
        baseConfig: best-effort
        maxAttempts: 1