apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ai-reviewer

resources:
  - ../../base
  - ../../base/external-secrets
  - postgres/statefulset.yaml
  - vault/vault-token-secret.yaml

patches:
  - path: patches/replicas.yaml
  - path: patches/resource-limits.yaml
  - path: patches/local-config.yaml
  - path: patches/image-pull-policy.yaml
  - path: vault/secret-store-patch.yaml
  - path: vault/refresh-interval-patch.yaml

images:
  - name: ghcr.io/your-org/ai-code-reviewer/api-gateway
    newName: ai-code-reviewer/api-gateway
    newTag: "local"
  - name: ghcr.io/your-org/ai-code-reviewer/llm-worker
    newName: ai-code-reviewer/llm-worker
    newTag: "local"

configMapGenerator:
  - name: app-config
    behavior: merge
    literals:
      - redis.host=redis
      - redis.port=6379
      - llm.model=gpt-4o-mini
      - llm.base-url=https://api.openai.com/v1
      - log.level=DEBUG
      - gitlab.api-url=http://host.docker.internal:80
      - jira.base-url=http://host.docker.internal:8080
